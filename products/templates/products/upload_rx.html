{% extends 'base.html' %}

{% block content %}
<style>
    .rx-upload-container {
        max-width: 600px;
        width: 100%;
        margin: 0 auto;
        padding: 4rem 1rem;
    }

    .file-upload-wrapper {
        border: 2px dashed #ddd;
        padding: 2rem;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
        position: relative;
        transition: 0.3s;
    }

    .file-upload-wrapper:hover {
        border-color: var(--secondary-color);
        background: #f9f9f9;
    }

    @media (max-width: 768px) {
        .rx-upload-container {
            padding: 2rem 1rem;
        }

        .card {
            padding: 1.5rem !important;
        }

        h2 {
            font-size: 1.5rem;
        }
    }
</style>

<div class="container rx-upload-container">
    <div class="card"
        style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h2 style="text-align: center; color: var(--primary-color); margin-bottom: 1.5rem;">Upload Prescription</h2>
        <p style="text-align: center; color: #666; margin-bottom: 2rem;">
            Upload a clear image of your prescription. Our AI will analyze it and suggest medicines for you.
        </p>

        <form id="rx-upload-form" method="post" enctype="multipart/form-data"
            style="display: flex; flex-direction: column; gap: 1.5rem;">
            {% csrf_token %}

            <div class="file-upload-wrapper">
                <input type="file" name="rx_image" accept="image/*" required
                    style="position: absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;"
                    onchange="document.getElementById('file-name').textContent = this.files[0].name">
                <i class="fas fa-cloud-upload-alt fa-3x"
                    style="color: var(--secondary-color); margin-bottom: 1rem;"></i>
                <p style="margin: 0; font-weight: 500;">Click to upload or drag and drop</p>
                <p id="file-name" style="margin-top: 0.5rem; color: var(--primary-color); font-size: 0.9rem;"></p>
            </div>

            <button type="submit" class="btn-primary" style="width: 100%; justify-content: center;">
                Analyze & Search Medicines
            </button>
        </form>

        {% if error %}
        <div class="alert alert-danger"
            style="margin-top: 1rem; padding: 10px; background: #ffebee; color: #c62828; border-radius: 4px;">
            {{ error }}
        </div>
        {% endif %}
    </div>
</div>

<div id="loading-overlay"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; flex-direction: column; align-items: center; justify-content: center;">
    <div class="spinner"></div>
    <h3 style="color: var(--primary-color); margin-top: 1.5rem; font-weight: 600;">Analyzing Prescription...</h3>
    <p style="color: #666; font-size: 1.1rem;">Please wait while AI identifies your medicines.</p>
</div>

<style>
    .spinner {
        width: 60px;
        height: 60px;
        border: 6px solid #f3f3f3;
        border-top: 6px solid var(--secondary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('rx-upload-form');
        const loader = document.getElementById('loading-overlay');

        if (form) {
            form.addEventListener('submit', function (e) {
                // simple client-side validation check before showing loader
                const fileInput = document.querySelector('input[type="file"]');
                if (fileInput.files.length > 0) {
                    loader.style.display = 'flex';
                }
            });
        }
    });
</script>
{% endblock %}