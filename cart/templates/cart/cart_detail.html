{% extends 'base.html' %}

<style>
    @media (max-width: 768px) {
        .cart-layout {
            grid-template-columns: 1fr !important;
        }
    }
</style>


{% block content %}
<div class="container" style="margin-top: 2rem;">

    <h2 class="section-title">Shopping Cart</h2>

    {% if cart.items.all %}
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">

        <!-- CART ITEMS -->
        <div>
            {% for item in cart.items.all %}
            <div class="product-card"
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.2rem; padding:1.2rem;">

                <div style="display:flex; align-items:center; gap:1rem; flex:1;">
                    {% if item.product.image %}
                    <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}"
                        style="width:80px; height:80px; object-fit:contain;"
                        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22%3E%3Crect fill=%22%23e0e0e0%22 width=%2280%22 height=%2280%22/%3E%3C/svg%3E'">
                    {% else %}
                    <div
                        style="width:80px; height:80px; display:flex; align-items:center; justify-content:center; background:#f0f0f0; border-radius:4px;">
                        <i class="fas fa-box" style="color:#ccc; font-size:2rem;"></i>
                    </div>
                    {% endif %}

                    <div>
                        <h3 class="prod-name" style="margin-bottom:4px;">{{ item.product.name }}</h3>
                        <p class="prod-desc">₹{{ item.product.price|floatformat:2 }} each</p>
                    </div>
                </div>

                <div style="display:flex; align-items:center; gap:1rem;">

                    <form method="POST" action="/cart/update/{{ item.id }}/"
                        style="display:flex; align-items:center; gap:0.5rem;">
                        {% csrf_token %}
                        <input type="number" name="quantity" value="{{ item.quantity }}" min="1"
                            style="width:60px; padding:0.5rem; border:1px solid var(--border); border-radius:6px;">
                        <button type="submit" class="btn-primary" style="padding:0.5rem 1.2rem;">Update</button>
                    </form>

                    <div
                        style="font-size:1.2rem; font-weight:700; color:var(--primary-color); min-width:90px; text-align:right;">
                        ₹{{ item.get_subtotal|floatformat:2 }}
                    </div>

                    <a href="/cart/remove/{{ item.id }}/"
                        style="color:#d9534f; font-size:1.4rem; text-decoration:none;">✕</a>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- CART TOTAL -->
        <div class="product-card" style="padding:2rem;">
            <h2 style="margin-bottom:1rem;">Cart Total</h2>
            <p style="font-size:2rem; font-weight:700; color:var(--primary-color); margin-bottom:1.5rem;">
                ₹{{ cart.get_total|floatformat:2 }}
            </p>
            <a href="/cart/checkout/" class="btn-primary"
                style="width:100%; text-align:center; display:block; padding:1rem;">
                Proceed to Checkout
            </a>
        </div>

    </div>

    {% else %}
    <!-- EMPTY CART -->
    <div class="product-card" style="text-align:center; padding:4rem; margin-top:2rem;">
        <p style="font-size:1.3rem; margin-bottom:1rem;">Your cart is empty</p>
        <a href="/products/" class="btn-primary" style="padding:0.8rem 2rem;">Continue Shopping</a>
    </div>
    {% endif %}

</div>
{% endblock %}